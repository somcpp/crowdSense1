<!DOCTYPE html>
<html>
<head>
    <title>Crowd Heatmap</title>
    <style>
        body { font-family: Arial; display: flex; justify-content: center; gap: 40px; }
        #left, #right { display: flex; flex-direction: column; align-items: center; }

        #heatmap {
            display: grid;
            grid-template-columns: repeat(4, 50px);
            grid-template-rows: repeat(4, 50px);
            gap: 4px;
            margin-top: 20px;
        }

        .cell {
            width: 50px;
            height: 50px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="left">
        <h2>Live Feed</h2>
        <img src="{{ url_for('video_feed') }}" width="480" height="360" />
    </div>

    <div id="right">
        <h2>Live Heatmap</h2>
        <div id="heatmap"></div>
    </div>

    <script>
        const heatmap = document.getElementById('heatmap');

        for (let i = 0; i < 16; i++) {
            const div = document.createElement('div');
            div.className = 'cell';
            heatmap.appendChild(div);
        }

        function updateHeatmap() {
            fetch('/heatmap_data')
                .then(res => res.json())
                .then(data => {
                    const flatGrid = data.grid.flat();
                    const max = Math.max(...flatGrid, 1);

                    document.querySelectorAll('.cell').forEach((cell, i) => {
                        const val = flatGrid[i];
                        const ratio = val / max;

                        if (val === 0) {
                            cell.style.backgroundColor = '#d4fcd4';
                        } else if (ratio < 0.4) {
                            cell.style.backgroundColor = '#ffff66';
                        } else if (ratio < 0.8) {
                            cell.style.backgroundColor = 'orange';
                        } else {
                            cell.style.backgroundColor = 'red';
                        }
                    });
                });
        }

        setInterval(updateHeatmap, 1000);
    </script>
</body>
</html>
